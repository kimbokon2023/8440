<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive API 테스트</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Google Drive 파일 관리 API 테스트</h1>
    
    <div>
        <h2>1. 연결 테스트</h2>
        <button onclick="testConnection()">Google Drive 연결 테스트</button>
        <div id="connectionResult"></div>
    </div>
    
    <div>
        <h2>2. 파일 목록 조회</h2>
        <input type="text" id="tablename" placeholder="테이블명" value="test_table">
        <input type="text" id="parentnum" placeholder="부모번호" value="123">
        <button onclick="testGetFiles()">파일 목록 조회</button>
        <div id="filesResult"></div>
    </div>
    
    <div>
        <h2>3. 파일 업로드</h2>
        <input type="file" id="fileInput" multiple>
        <button onclick="testUpload()">파일 업로드</button>
        <div id="uploadResult"></div>
    </div>
    
    <div>
        <h2>4. 도움말</h2>
        <button onclick="showHelp()">도움말 보기</button>
        <div id="helpResult"></div>
    </div>

    <script>
        function testConnection() {
            $.ajax({
                url: 'file_api_test.php',
                type: 'GET',
                data: { action: 'testConnection' },
                dataType: 'json',
                success: function(response) {
                    $('#connectionResult').html('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
                },
                error: function(xhr, status, error) {
                    $('#connectionResult').html('<div style="color: red;">오류: ' + error + '</div>');
                }
            });
        }
        
        function testGetFiles() {
            const tablename = $('#tablename').val();
            const parentnum = $('#parentnum').val();
            
            $.ajax({
                url: 'file_api_test.php',
                type: 'GET',
                data: { 
                    action: 'getFiles',
                    tablename: tablename,
                    parentnum: parentnum
                },
                dataType: 'json',
                success: function(response) {
                    $('#filesResult').html('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
                },
                error: function(xhr, status, error) {
                    $('#filesResult').html('<div style="color: red;">오류: ' + error + '</div>');
                }
            });
        }
        
        function testUpload() {
            const files = document.getElementById('fileInput').files;
            if (files.length === 0) {
                alert('파일을 선택해주세요.');
                return;
            }
            
            const formData = new FormData();
            formData.append('action', 'upload');
            formData.append('tablename', 'test_table');
            formData.append('parentnum', '123');
            
            for (let i = 0; i < files.length; i++) {
                formData.append('files[]', files[i]);
            }
            
            $.ajax({
                url: 'file_api_test.php',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                dataType: 'json',
                success: function(response) {
                    $('#uploadResult').html('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
                },
                error: function(xhr, status, error) {
                    $('#uploadResult').html('<div style="color: red;">오류: ' + error + '</div>');
                }
            });
        }
        
        function showHelp() {
            $.ajax({
                url: 'file_api_test.php',
                type: 'GET',
                data: { action: 'help' },
                dataType: 'json',
                success: function(response) {
                    $('#helpResult').html('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
                },
                error: function(xhr, status, error) {
                    $('#helpResult').html('<div style="color: red;">오류: ' + error + '</div>');
                }
            });
        }
    </script>
</body>
</html>
